"""
–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —ç–∫–∑–∞–º–µ–Ω–∞ üå∂Ô∏è

–í–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω —Ñ–∞–π–ª exam_results.csv, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø—Ä–æ—à–µ–¥—à–µ–º —ç–∫–∑–∞–º–µ–Ω–µ –≤ –Ω–µ–∫–æ—Ç–æ—Ä–æ–º —É—á–µ–±–Ω–æ–º –∑–∞–≤–µ–¥–µ–Ω–∏–∏. –í
–ø–µ—Ä–≤–æ–º —Å—Ç–æ–ª–±—Ü–µ –∑–∞–ø–∏—Å–∞–Ω–æ –∏–º—è —Å—Ç—É–¥–µ–Ω—Ç–∞, –≤–æ –≤—Ç–æ—Ä–æ–º ‚Äî —Ñ–∞–º–∏–ª–∏—è, –≤ —Ç—Ä–µ—Ç—å–µ–º ‚Äî –æ—Ü–µ–Ω–∫–∞ –∑–∞ —ç–∫–∑–∞–º–µ–Ω, –≤ —á–µ—Ç–≤–µ—Ä—Ç–æ–º ‚Äî –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è
—Å–¥–∞—á–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ YYYY-MM-DD HH:MM:SS, –≤ –ø—è—Ç–æ–º ‚Äî –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã:

name,surname,score,date_and_time,email
Jayson,Edwards,2,2021-11-10 10:00:00,sonnen@yahoo.com
April,Sims,3,2021-11-01 11:00:00,retoh@outlook.com
...

–ö–∞–∂–¥—ã–π —Å—Ç—É–¥–µ–Ω—Ç –∏–º–µ–µ—Ç –ø—Ä–∞–≤–æ –ø–µ—Ä–µ—Å–¥–∞—Ç—å —ç–∫–∑–∞–º–µ–Ω –¥–≤–∞ —Ä–∞–∑–∞, –ø–æ—ç—Ç–æ–º—É –æ–Ω –º–æ–∂–µ—Ç –≤—Å—Ç—Ä–µ—á–∞—Ç—å—Å—è –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–∞–π–ª–µ –¥–æ —Ç—Ä—ë—Ö —Ä–∞–∑ —Å
—Ä–∞–∑–ª–∏—á–Ω–æ–π –æ—Ü–µ–Ω–∫–æ–π –∏ —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –¥–∞—Ç–æ–π –∏ –≤—Ä–µ–º–µ–Ω–µ–º —Å–¥–∞—á–∏.

–ù–∞–ø–∏—à–∏—Ç–µ –ø—Ä–æ–≥—Ä–∞–º–º—É, –∫–æ—Ç–æ—Ä–∞—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç –µ–≥–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—É—é –æ—Ü–µ–Ω–∫—É, –∞ —Ç–∞–∫–∂–µ –¥–∞—Ç—É –∏ –≤—Ä–µ–º—è –µ–µ
–ø–æ–ª—É—á–µ–Ω–∏—è. –ü—Ä–æ–≥—Ä–∞–º–º–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–∑–¥–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤–∞—Ä–µ–π, –∫–∞–∂–¥—ã–π –∏–∑ –∫–æ—Ç–æ—Ä—ã—Ö —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä—ã –∫–ª—é—á-–∑–Ω–∞—á–µ–Ω–∏–µ:


    name ‚Äî –∏–º—è —Å—Ç—É–¥–µ–Ω—Ç–∞
    surname ‚Äî —Ñ–∞–º–∏–ª–∏—è —Å—Ç—É–¥–µ–Ω—Ç–∞
    best_score ‚Äî –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ –∑–∞ —ç–∫–∑–∞–º–µ–Ω
    date_and_time ‚Äî –¥–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø–æ–ª—É—á–µ–Ω–∏—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –æ—Ü–µ–Ω–∫–∏ –≤ –∏—Å—Ö–æ–¥–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
    email ‚Äî –∞–¥—Ä–µ—Å —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –ø–æ—á—Ç—ã

–ü–æ–ª—É—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–æ–ª–∂–Ω–∞ –∑–∞–ø–∏—Å–∞—Ç—å –≤ —Ñ–∞–π–ª best_scores.json, –ø—Ä–∏—á–µ–º —Å–ª–æ–≤–∞—Ä–∏ –≤ —Å–ø–∏—Å–∫–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω—ã
–≤ –ª–µ–∫—Å–∏–∫–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º –ø–æ—Ä—è–¥–∫–µ –Ω–∞–∑–≤–∞–Ω–∏–π —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω—ã—Ö –ø–æ—á—Ç.

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ 1. –ï—Å–ª–∏ –ø—Ä–∏ –ø–µ—Ä–µ—Å–¥–∞—á–µ —Å—Ç—É–¥–µ–Ω—Ç –ø–æ–ª—É—á–∏–ª —Ç–∞–∫—É—é –∂–µ –æ—Ü–µ–Ω–∫—É, —á—Ç–æ –∏ –≤ –ø—Ä–æ—à–ª—ã–π —Ä–∞–∑, —Ç–æ –≤ –∫–∞—á–µ—Å—Ç–≤–µ –¥–∞—Ç—ã —Å–ª–µ–¥—É–µ—Ç
—É–∫–∞–∑–∞—Ç—å –¥–∞—Ç—É –ø–µ—Ä–µ—Å–¥–∞—á–∏.
–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ 2. –í –∫–∞—á–µ—Å—Ç–≤–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è –≤ —Ñ–∞–π–ª–µ exam_results.csv –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∑–∞–ø—è—Ç–∞—è, –ø—Ä–∏ —ç—Ç–æ–º –∫–∞–≤—ã—á–∫–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è.
–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ 3. –ù–∞—á–∞–ª—å–Ω–∞—è —á–∞—Å—Ç—å —Ñ–∞–π–ª–∞ best_scores.json –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

[
   {
      "name": "Stephen",
      "surname": "Farley",
      "best_score": 3,
      "date_and_time": "2021-11-12 12:00:00",
      "email": "aardo@mac.com"
   },
   {
      "name": "Kaylen",
      "surname": "Horne",
      "best_score": 4,
      "date_and_time": "2021-11-09 11:00:00",
      "email": "aaribaud@att.net"
   },
   ...
]

–†–µ—à–µ–Ω–∏–µ
–ò–¥–µ—è –∑–∞–∫–ª—é—á–∞–µ—Ç—Å—è –≤ —Å–ª–µ–¥—É—é—â–µ–º:
1) –°—á–∏—Ç—ã–≤–∞–µ–º —Ñ–∞–π–ª, —Ç—É—Ç –≤—Å—ë –ø–æ–Ω—è—Ç–Ω–æ.
2) –ü—Ä–∏ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –≤ –æ–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ —Å—Ä–∞–∑—É —É–¥–∞–ª—è–µ–º –∫–ª—é—á 'score' –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ–¥ –∫–ª—é—á–æ–º 'best_score'
3) –ò–∑ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–µ–≥–æ —Å–ª–æ–≤–∞—Ä—è –ø–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ –∫–ª—é—á—É 'email'.
   –ï—Å–ª–∏ –µ–≥–æ –µ—â—ë —Ç–∞–º –Ω–µ—Ç, —Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º –±—É–¥–µ—Ç —Å–ª–æ–≤–∞—Ä—å, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∏–∑ —Ñ–∞–π–ª–∞ –Ω–∞ —Ç–µ–∫—É—â–µ–π –∏—Ç–µ—Ä–∞—Ü–∏–∏

4) –ò–∑ –¥–≤—É—Ö —Å–ª–æ–≤–∞—Ä–µ–π (–ø–µ—Ä–≤—ã–π ‚Äî –æ—á–µ—Ä–µ–¥–Ω–æ–π —Å–ª–æ–≤–∞—Ä—å –∏–∑ —Ñ–∞–π–ª–∞, –≤—Ç–æ—Ä–æ–π ‚Äî —Å–ª–æ–≤–∞—Ä—å, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –Ω–∞ —à–∞–≥–µ 33) –≤—ã–±–∏—Ä–∞–µ–º —Ç–æ—Ç,
–≤ –∫–æ—Ç–æ—Ä–æ–º –æ—Ü–µ–Ω–∫–∞ –≤—ã—à–µ. –ï—Å–ª–∏ –æ—Ü–µ–Ω–∫–∏ —Å–æ–≤–ø–∞–¥–∞—é—Ç, –±—É–¥–µ—Ç –≤—ã–±—Ä–∞–Ω —Ç–æ—Ç, —É –∫–æ—Ç–æ—Ä–æ–≥–æ –±–æ–ª–µ–µ –ø–æ–∑–¥–Ω—è—è –¥–∞—Ç–∞.

5) –í —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π —Å–ª–æ–≤–∞—Ä—å –ø–æ –∫–ª—é—á—É 'email', –≤–∑—è—Ç–æ–º –∏–∑ —Å–ª–æ–≤–∞—Ä—è, –Ω–∞—Ö–æ–¥—è—â–µ–≥–æ—Å—è –≤ —Ñ–∞–π–ª–µ, –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –∏–∑ —à–∞–≥–∞ 4
6) –°–æ—Ä—Ç–∏—Ä—É–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–µ–≥–æ —Å–ª–æ–≤–∞—Ä—è –ø–æ –∫–ª—é—á—É 'email'
7) –ó–∞–ø–∏—Å—ã–≤–∞–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –Ω–æ–≤—ã–π —Ñ–∞–π–ª

–¢–µ–º —Å–∞–º—ã–º, –∑–∞ –æ–¥–Ω—É –∏—Ç–µ—Ä–∞—Ü–∏—é –ø–æ –≤—Ö–æ–¥—è—â–µ–º—É —Ñ–∞–π–ª—É –æ—Ç–æ–±—Ä–∞–ª–∏ –Ω–∞–∏–ª—É—á—à–∏–µ –æ—Ü–µ–Ω–∫–∏ –∫–∞–∂–¥–æ–≥–æ –∏–∑ —É—á–µ–Ω–∏–∫–æ–≤, –∑–∞—Ç–µ–º –æ—Ç—Å–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏ –∏
—Å–æ—Ö—Ä–∞–Ω–∏–ª–∏ –≤ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π —Ñ–∞–π–ª

"""
# import csv
# import json

import pandas as pd

df = pd.read_csv('exam_results.csv')
df_out = df.groupby(['name', 'surname'], as_index=False).agg(max)
df_out = df_out.sort_values('email').rename(columns={'score': 'best_score'})
df_out.to_json('best_scores.json', orient='records', indent=3)



# –†–µ—à–µ–Ω–∏–µ ‚Ññ 1
# from datetime import datetime as dt
#
# result = {}
# with open('exam_results.csv', encoding='utf-8') as ex_r:
#     for row in csv.DictReader(ex_r): # 1
#         row['best_score'] = int(row.pop('score'))  # 2
#         r = result.get(row['email'], row)  # 3
#         best_row = max(r, row, key=lambda item: (item['best_score'], item['date_and_time']))  # 4
#         result[row['email']] = best_row  # 5
#
# with open('best_scores.json', 'w', encoding='utf-8') as bs:
#     out = sorted(result.values(), key=lambda item: item['email'])  # 6
#     json.dump(out, bs, indent=3)  # 7
#

# –ú–æ–µ —Ä–µ—à–µ–Ω–∏–µ

# with (open('exam_results.csv', encoding='utf-8') as f_in,
#       open('best_scores.json', 'w', encoding='utf-8') as f_out):
#     res, res_out = {}, []
#     mask_dt = '%Y-%m-%d %H:%M:%S'
#     for s in csv.DictReader(f_in):
#         d_ex = dt.strptime(s['date_and_time'], mask_dt)
#         res.setdefault((s['email'], s['name'], s['surname']), {}).setdefault(int(s['score']), []).append(d_ex)
#
#     for k, v in res.items():
#         max_sc = max(v.keys())
#         date = dt.strftime(max(v[max_sc]), mask_dt)
#         d_out = {'name': k[1], 'surname': k[2], 'best_score': max_sc, 'date_and_time': date, 'email': k[0]}
#         res_out.append(d_out)
#
#     json.dump(sorted(res_out, key=lambda x: x['email']), f_out, indent=3)

# ##### –†–µ—à–µ–Ω–∏–µ 3
# with open('exam_results.csv', encoding='utf8') as f_in:
#     header, *rows = csv.reader(f_in)
#
# # —Å–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ–ª—É—á–µ–Ω–Ω—ã–π —Å–ø–∏—Å–æ–∫ –ø–æ email, score, date_and_time
# rows.sort(key=lambda x: (x[4], x[2], x[3]))
#
# # —Ñ–æ—Ä–º–∏—Ä—É–µ–º —Å–ª–æ–≤–∞—Ä—å
# res = {}
# for name, surname, score, date, email in rows:
#     res[email] = {
#                  'name': name,
#                  'surname': surname,
#                  'best_score': int(score),
#                  'date_and_time': date,
#                  'email': email
#                  }
#
# # –≤—ã–≥—Ä—É–∂–∞–µ–º –≤ json
# with open('best_scores.json', 'w', encoding='utf8') as f_out:
#     json.dump(list(res.values()), f_out, indent=3)
